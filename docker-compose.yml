version: '3'
services:
  config:
    build: ./Lab.ServiceConfiguration
    container_name: configuration-service
    hostname: 10.15.1.2
    environment:
      - "EUREKA_SERVER=http://khoa:welcome123@10.15.1.1:18761/eureka"
    networks:
      labdiscoveryservice_microservice:
        ipv4_address: 10.15.1.2
    #ports:
      #- 11512:11512
    expose:
       - "11512"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://10.15.1.2:11512"]
      interval: 30s
      timeout: 10s
      retries: 5
  data-capture:
    build: ./Lab.DataCapture
    container_name: data-capture-service
    hostname: 10.15.1.3
    restart: on-failure
    depends_on:
      - config
    environment:
      - "EUREKA_SERVER=http://khoa:welcome123@10.15.1.1:18761/eureka"
      - "EUREKA_CONFIG_SERVER=http://10.15.1.2:11512"
      - "server.port=11513"
    networks:
      labdiscoveryservice_microservice:
        ipv4_address: 10.15.1.3
    #ports:
      #- 11513:11513
    expose:
     - "11513"
  cassandra:
    build: ./Lab.Cassandra
    container_name: cassandra-service
    hostname: 10.15.1.4
    restart: on-failure
    depends_on:
      - config
    environment:
      - "EUREKA_SERVER=http://khoa:welcome123@10.15.1.1:18761/eureka"
      - "EUREKA_CONFIG_SERVER=http://10.15.1.2:11512"
      - "server.port=11514"
    networks:
      labdiscoveryservice_microservice:
        ipv4_address: 10.15.1.4
    #ports:
      #- 11514:11514
    expose:
      - "11514"
      
  ui:
    build: ./Lab.UI
    container_name: ui-service
    hostname: 10.15.1.5
    restart: on-failure
    depends_on:
      - config
    environment:
      - "EUREKA_SERVER=http://khoa:welcome123@10.15.1.1:18761/eureka"
      - "EUREKA_CONFIG_SERVER=http://10.15.1.2:11512"
      - "server.port=11515"
    networks:
      labdiscoveryservice_microservice:
        ipv4_address: 10.15.1.5
    ports:
      - 11515:11515
    expose:
      - "11515"
      
networks:
  labdiscoveryservice_microservice:
    external: true
